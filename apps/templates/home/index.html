{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}
{% load static %}			
	<div class="content">
		<div class="panel-header" style="background-image: url('{% static 'assets/img/background.jpeg' %}');">
			<div class="page-inner py-5">
				<div class="d-flex align-items-left align-items-md-center flex-column flex-md-row">
					<div>
						<h2 class="text-white pb-2 fw-bold animate__animated animate__pulse">Dashboard</h2>
					</div>
				</div>
			</div>
		</div>
		
		<div class="page-inner mt--5">
			
			<div class="row mt--2">
				<div class="col-md-12 animate__animated animate__fadeIn">
					<div class="card full-height">
						<div class="card-body">
							<div class="card-title">Overall Statistics</div>
							<div class="card-category">Information about statistics in system</div>
							<p></p>
							<div class="row">
								<div class="col d-flex">
									<div class="flex-fill">
										<div class="card card-stats card-primary card-round"  onmouseover="this.style.transform = 'scale(1.02)';" onmouseout="this.style.transform = 'scale(1)';">
											<div class="card-body">
												<div class="row">
													<div class="col-5">
														<div class="icon-big text-center">
															<i class="fas fa-building"></i>
														</div>
													</div>
													<div class="col-7 col-stats">
														<div class="numbers">
															<p class="card-category">Customers</p>
															<h4 class="card-title text-center">{{ total_customers|default:0 }}</h4>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col d-flex">
									<div class="flex-fill">
										<div class="card card-stats card-info card-round" onmouseover="this.style.transform = 'scale(1.02)';" onmouseout="this.style.transform = 'scale(1)';">
											<div class="card-body">
												<div class="row">
													<div class="col-5">
														<div class="icon-big text-center">
															<i class="far fa-eye"></i>
														</div>
													</div>
													<div class="col-7 col-stats">
														<div class="numbers">
															<p class="card-category">Detection Systems</p>
															<h4 class="card-title text-center">{{total_detection_systems|default:0}}</h4>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col d-flex">
									<div class="flex-fill">
										<div class="card card-stats card-success card-round" onmouseover="this.style.transform = 'scale(1.02)';" onmouseout="this.style.transform = 'scale(1)';">
											<div class="card-body ">
												<div class="row">
													<div class="col-5">
														<div class="icon-big text-center">
															<i class="fas fa-ruler"></i>
														</div>
													</div>
													<div class="col-7 col-stats">
														<div class="numbers">
															<p class="card-category">Rules</p>
															<h4 class="card-title text-center">{{ total_rules|default:0 }}</h4>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col d-flex">
									<div class="flex-fill">
										<div class="card card-stats card-secondary card-round" onmouseover="this.style.transform = 'scale(1.02)';" onmouseout="this.style.transform = 'scale(1)';">
											<div class="card-body card-warning card-round">
												<div class="row">
													<div class="col-5">
														<div class="icon-big text-center">
															<i class="fas fa-glasses"></i>
														</div>
													</div>
													<div class="col-7 col-stats">
														<div class="numbers">
															<p class="card-category">Watchers</p>
															<h4 class="card-title text-center">{{ total_watchers|default:0 }}</h4>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col d-flex">
									<div class="flex-fill">
										<div class="card card-stats card-secondary card-round" onmouseover="this.style.transform = 'scale(1.02)';" onmouseout="this.style.transform = 'scale(1)';">
											<div class="card-body ">
												<div class="row">
													<div class="col-5">
														<div class="icon-big text-center">
															<i class="far fa-newspaper"></i>
														</div>
													</div>
													<div class="col-7 col-stats">
														<div class="numbers">
															<p class="card-category">Reports</p>
															<h4 class="card-title text-center">{{ total_reports|default:0 }}</h4>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Overall Stats -->
			<div class="row">
				<div class="col-md-4 animate__animated animate__bounceInLeft">
					<div class="card full-height">
						<div class="card-body ">
							<div class="card-title">Created Rules This Week</div>
							<div class="row py-3">
								<div class="col-md-4 d-flex flex-column justify-content-around">
									<div>
										<h6 class="fw-bold text-uppercase text-success op-8">Rules</h6>
										<h3 class="fw-bold">{{total_rules_in_week}}</h3>
									</div>
								</div>
								<div class="col-md-8 flex-grow-1">
									<div id="chart-container">
										<canvas id="totalIncomeChartWeek-rules"></canvas>
									</div>
								</div>
							</div>
							<div class="card-title">Created Rules This Year</div>
							<div class="row py-3">
								<div class="col-md-4 d-flex flex-column justify-content-around">
									<div>
										<h6 class="fw-bold text-uppercase text-success op-8">Rules</h6>
										<h3 class="fw-bold">{{total_rules_in_year}}</h3>
										<h6 class="fw-bold text-uppercase text-danger op-8">Rules by Type of Detection System</h6>
										{% for result in total_rules_by_detection_system_type %}
											<h5 class="fw-bold">{{ result.type }} ({{ result.rule_count }})</h5>
										{% endfor %}
									</div>
								</div>
								<div class="col-md-8 flex-grow-1">
									<div id="chart-container" style="height: 100%;">
										<canvas id="totalIncomeChartMonth-rules"></canvas>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-4 animate__animated animate__fadeIn">
					<div class="card full-height">
						<div class="card-body">
							<div class="card-title">Created Watchers This Week</div>
							<div class="row py-3">
								<div class="col-md-4 d-flex flex-column justify-content-around">
									<div>
										<h6 class="fw-bold text-uppercase text-success op-8">watchers</h6>
										<h3 class="fw-bold">{{total_watchers_in_week}}</h3>
									</div>
								</div>
								<div class="col-md-8 flex-grow-1">
									<div id="chart-container">
										<canvas id="totalIncomeChartWeek-watchers"></canvas>
									</div>
								</div>
							</div>
							<div class="card-title">Created Watchers This Year</div>
							<div class="row py-3">
								<div class="col-md-4 d-flex flex-column justify-content-around">
									<div>
										<h6 class="fw-bold text-uppercase text-success op-8">Watchers</h6>
										<h3 class="fw-bold">{{total_watchers_in_year}}</h3>
									</div>
								</div>
								<div class="col-md-8 flex-grow-1">
									<div id="chart-container" style="height: 100%;">
										<canvas id="totalIncomeChartMonth-watchers"></canvas>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-4 animate__animated animate__bounceInRight">
					<div class="card full-height">
						<div class="card-body">
							<div class="card-title">Created Reports This Week</div>
							<div class="row py-3">
								<div class="col-md-4 d-flex flex-column justify-content-around">
									<div>
										<h6 class="fw-bold text-uppercase text-success op-8">Reports</h6>
										<h3 class="fw-bold">{{total_reports_in_week}}</h3>
									</div>
								</div>
								<div class="col-md-8 flex-grow-1">
									<div id="chart-container">
										<canvas id="totalIncomeChartWeek-reports"></canvas>
									</div>
								</div>
							</div>
							<div class="card-title">Created Reports This Year</div>
							<div class="row py-3">
								<div class="col-md-4 d-flex flex-column justify-content-around">
									<div>
										<h6 class="fw-bold text-uppercase text-success op-8">Reports</h6>
										<h3 class="fw-bold">{{total_reports_in_year}}</h3>
									</div>
								</div>
								<div class="col-md-8 flex-grow-1">
									<div id="chart-container" style="height: 100%;">
										<canvas id="totalIncomeChartMonth-reports"></canvas>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Overall Stats 2 -->
			<div class="row">
				<div class="col-md-12 animate__animated animate__fadeIn">
					<div class="card full-height">
						<div class="card-header">
							<div class="card-title">Rules | Watchers | Reports by Month</div>
						</div>
						<div class="card-body">
							<div class="chart-container"><div class="chartjs-size-monitor" style="position: absolute; inset: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;"><div class="chartjs-size-monitor-expand" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div></div><div class="chartjs-size-monitor-shrink" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:200%;height:200%;left:0; top:0"></div></div></div>
								<canvas id="multipleLineChart" style="display: block; width: 815px; height: 300px;" width="815" height="300" class="chartjs-render-monitor"></canvas>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Rule Stats -->
			<div class="row">
				<div class="col-md-6 animate__animated animate__bounceInLeft">
					<div class="card full-height">
						<div class="card-header">
							<div class="card-title">Distribution of Rules by MITRE Tactic</div>
						</div>
						<div class="card-body">
							<div class="chart-container" style="height: 100%;">
								<canvas id="pieChart" style="width: 50%; height: 50%"></canvas>
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-6 animate__animated animate__bounceInRight">
					<div class="card full-height">
						<div class="card-header">
							<div class="card-title">Distribution of Rules by Severity</div>
						</div>
						<div class="card-body">
							<div class="chart-container" style="height: 100%;">
								<canvas id="radarChart"></canvas>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Rule Stats 2 -->
			<div class="row">
				<div class="col-md-12 animate__animated animate__fadeIn">
					<div class="card full-height">
						<div class="card-header">
							<div class="card-head-row">
								<div class="card-title">Rule Distribution by Technology</div>
							</div>
						</div>
						<div class="card-body">
							<div class="table-responsive"> 
								<table id="distribution-rules-techonolgy" class="table table-striped table-striped-bg-default mt-3">
									<thead>
										<tr>
											<th scope="col">#</th>
											<th scope="col">Technology</th>
											<th scope="col">Rules</th>
										</tr>
									</thead>
										<tbody>
											{% if recent_rules %}
												{% for technology in rule_counts_by_technology %}
													<tr>
														<td>{{ forloop.counter }}</td>
														<td>{{ technology.technologies__name }}</td>
														<td>{{ technology.rule_count }}</td>
													</tr>
												{% endfor %}
											{% endif %}
										</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Users Stats -->
			<div class="row">
				
				<div class="col-md-4 animate__animated animate__bounceInLeft">
					<div class="card full-height">
						<div class="card-header">
							<h4 class="card-title">Top Creators Today</h4>
						</div>
						<div class="card-body">
							<div class="d-flex justify-content-end">
								<ul class="nav nav-pills nav-secondary" id="pills-tab" role="tablist">
									<li class="nav-item">
										<a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#top_rules_today" role="tab" aria-controls="top_rules_today" aria-selected="true">Rules</a>
									</li>
									<li class="nav-item">
										<a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#top_watchers_today" role="tab" aria-controls="top_watchers_today" aria-selected="false">Watchers</a>
									</li>
									<li class="nav-item">
										<a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#top_reports_today" role="tab" aria-controls="top_reports_today" aria-selected="false">Reports</a>
									</li>
								</ul>
							</div>
							<div class="tab-content mt-2 mb-3" id="pills-tabContent">
								<p></p>
								<div class="tab-pane fade show active" id="top_rules_today" role="tabpanel" aria-labelledby="top_rules_today-tab">
									{% if top_users_rules_last_today %}
										{% for user in top_users_rules_last_today %}
										<div class="d-flex">
											<div class="avatar">
												<span class="avatar-title rounded-circle border border-white bg-info">{{user|make_list|first|upper}}</span>
											</div>
											<div class="flex-1 ml-3 pt-1">
												<h6 class="text-uppercase fw-bold mb-1">{% if forloop.counter == 1 %}<i class="fa fa-chess-king text-warning"></i>{% endif %} {{user}}</h6>
											</div>
											<div class="float-right pt-1">
												<small class="text-muted">Top {{forloop.counter}}</small>
											</div>
										</div>
										<div class="separator-dashed"></div>
										{% endfor %}
									{% else %}
										<div class="d-flex">
											<p> There're no rules created by any user yet</p>
										</div>
									{% endif %}
								</div>
								<div class="tab-pane fade" id="top_watchers_today" role="tabpanel" aria-labelledby="top_watchers_today-tab">
									{% if top_users_watchers_last_today %}
										{% for user in  top_users_watchers_last_today %}
										<div class="d-flex">
											<div class="avatar">
												<span class="avatar-title rounded-circle border border-white bg-info">{{user|make_list|first|upper}}</span>
											</div>
											<div class="flex-1 ml-3 pt-1">
												<h6 class="text-uppercase fw-bold mb-1">{% if forloop.counter == 1 %}<i class="fa fa-chess-king text-warning"></i>{% endif %} {{user}}</h6>
											</div>
											<div class="float-right pt-1">
												<small class="text-muted">Top {{forloop.counter}}</small>
											</div>
										</div>
										<div class="separator-dashed"></div>
										{% endfor %}
									{% else %}
										<div class="d-flex">
											<p> There're no watchers created by any user yet</p>
										</div>
									{% endif %}
								</div>
								<div class="tab-pane fade" id="top_reports_today" role="tabpanel" aria-labelledby="top_reports_today-tab">
									{% if top_users_reports_last_today %}
										{% for user in  top_users_reports_last_today %}
										<div class="d-flex">
											<div class="avatar">
												<span class="avatar-title rounded-circle border border-white bg-info">{{user|make_list|first|upper}}</span>
											</div>
											<div class="flex-1 ml-3 pt-1">
												<h6 class="text-uppercase fw-bold mb-1">{% if forloop.counter == 1 %}<i class="fa fa-chess-king text-warning"></i>{% endif %} {{user}}</h6>
											</div>
											<div class="float-right pt-1">
												<small class="text-muted">Top {{forloop.counter}}</small>
											</div>
										</div>
										<div class="separator-dashed"></div>
										{% endfor %}
									{% else %}
										<div class="d-flex">
											<p> There're no reports created by any user yet</p>
										</div>
									{% endif %}
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="col-md-4 animate__animated animate__fadeIn">
					<div class="card full-height">
						<div class="card-header">
							<h4 class="card-title">Top Creators This Week</h4>
						</div>
						<div class="card-body">
							<div class="d-flex justify-content-end">
								<ul class="nav nav-pills nav-secondary" id="pills-tab" role="tablist">
									<li class="nav-item">
										<a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#top_rules_week" role="tab" aria-controls="top_rules_week" aria-selected="true">Rules</a>
									</li>
									<li class="nav-item">
										<a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#top_watchers_week" role="tab" aria-controls="top_watchers_week" aria-selected="false">Watchers</a>
									</li>
									<li class="nav-item">
										<a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#top_reports_week" role="tab" aria-controls="top_reports_week" aria-selected="false">Reports</a>
									</li>
								</ul>
							</div>
							<div class="tab-content mt-2 mb-3" id="pills-tabContent">
								<p></p>
								<div class="tab-pane fade show active" id="top_rules_week" role="tabpanel" aria-labelledby="top_rules_week-tab">
									{% if top_users_rules_last_week %}
										{% for user in top_users_rules_last_week %}
										<div class="d-flex">
											<div class="avatar">
												<span class="avatar-title rounded-circle border border-white bg-info">{{user|make_list|first|upper}}</span>
											</div>
											<div class="flex-1 ml-3 pt-1">
												<h6 class="text-uppercase fw-bold mb-1">{% if forloop.counter == 1 %}<i class="fa fa-chess-king text-warning"></i>{% endif %} {{user}}</h6>
											</div>
											<div class="float-right pt-1">
												<small class="text-muted">Top {{forloop.counter}}</small>
											</div>
										</div>
										<div class="separator-dashed"></div>
										{% endfor %}
									{% else %}
										<div class="d-flex">
											<p> There're no rules created by any user yet</p>
										</div>
									{% endif %}
								</div>
								<div class="tab-pane fade" id="top_watchers_week" role="tabpanel" aria-labelledby="top_watchers_week-tab">
									{% if top_users_watchers_last_week %}
										{% for user in  top_users_watchers_last_week %}
										<div class="d-flex">
											<div class="avatar">
												<span class="avatar-title rounded-circle border border-white bg-info">{{user|make_list|first|upper}}</span>
											</div>
											<div class="flex-1 ml-3 pt-1">
												<h6 class="text-uppercase fw-bold mb-1">{% if forloop.counter == 1 %}<i class="fa fa-chess-king text-warning"></i>{% endif %} {{user}}</h6>
											</div>
											<div class="float-right pt-1">
												<small class="text-muted">Top {{forloop.counter}}</small>
											</div>
										</div>
										<div class="separator-dashed"></div>
										{% endfor %}
									{% else %}
										<div class="d-flex">
											<p> There're no watchers created by any user yet</p>
										</div>
									{% endif %}
								</div>
								<div class="tab-pane fade" id="top_reports_week" role="tabpanel" aria-labelledby="top_reports_week-tab">
									{% if top_users_reports_last_week %}
										{% for user in  top_users_reports_last_week %}
										<div class="d-flex">
											<div class="avatar">
												<span class="avatar-title rounded-circle border border-white bg-info">{{user|make_list|first|upper}}</span>
											</div>
											<div class="flex-1 ml-3 pt-1">
												<h6 class="text-uppercase fw-bold mb-1">{% if forloop.counter == 1 %}<i class="fa fa-chess-king text-warning"></i>{% endif %} {{user}}</h6>
											</div>
											<div class="float-right pt-1">
												<small class="text-muted">Top {{forloop.counter}}</small>
											</div>
										</div>
										<div class="separator-dashed"></div>
										{% endfor %}
									{% else %}
										<div class="d-flex">
											<p> There're no reports created by any user yet</p>
										</div>
									{% endif %}
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="col-md-4 animate__animated animate__bounceInRight">
					<div class="card full-height">
						<div class="card-header">
							<h4 class="card-title">Top Creators This Month</h4>
						</div>
						<div class="card-body">
							<div class="d-flex justify-content-end">
								<ul class="nav nav-pills nav-secondary" id="pills-tab" role="tablist">
									<li class="nav-item">
										<a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#top_rules_month" role="tab" aria-controls="top_rules_month" aria-selected="true">Rules</a>
									</li>
									<li class="nav-item">
										<a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#top_watchers_month" role="tab" aria-controls="top_watchers_month" aria-selected="false">Watchers</a>
									</li>
									<li class="nav-item">
										<a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#top_reports_month" role="tab" aria-controls="top_reports_month" aria-selected="false">Reports</a>
									</li>
								</ul>
							</div>
							<div class="tab-content mt-2 mb-3" id="pills-tabContent">
								<p></p>
								<div class="tab-pane fade show active" id="top_rules_month" role="tabpanel" aria-labelledby="top_rules_month-tab">
									{% if top_users_rules_last_month %}
										{% for user in top_users_rules_last_month %}
										<div class="d-flex">
											<div class="avatar">
												<span class="avatar-title rounded-circle border border-white bg-info">{{user|make_list|first|upper}}</span>
											</div>
											<div class="flex-1 ml-3 pt-1">
												<h6 class="text-uppercase fw-bold mb-1">{% if forloop.counter == 1 %}<i class="fa fa-chess-king text-warning"></i>{% endif %} {{user}}</h6>
											</div>
											<div class="float-right pt-1">
												<small class="text-muted">Top {{forloop.counter}}</small>
											</div>
										</div>
										<div class="separator-dashed"></div>
										{% endfor %}
									{% else %}
										<div class="d-flex">
											<p> There're no rules created by any user yet</p>
										</div>
									{% endif %}
								</div>
								<div class="tab-pane fade" id="top_watchers_month" role="tabpanel" aria-labelledby="top_watchers_month-tab">
									{% if top_users_watchers_last_month %}
										{% for user in  top_users_watchers_last_month %}
										<div class="d-flex">
											<div class="avatar">
												<span class="avatar-title rounded-circle border border-white bg-info">{{user|make_list|first|upper}}</span>
											</div>
											<div class="flex-1 ml-3 pt-1">
												<h6 class="text-uppercase fw-bold mb-1">{% if forloop.counter == 1 %}<i class="fa fa-chess-king text-warning"></i>{% endif %} {{user}}</h6>
											</div>
											<div class="float-right pt-1">
												<small class="text-muted">Top {{forloop.counter}}</small>
											</div>
										</div>
										<div class="separator-dashed"></div>
										{% endfor %}
									{% else %}
										<div class="d-flex">
											<p> There're no watchers created by any user yet</p>
										</div>
									{% endif %}
								</div>
								<div class="tab-pane fade" id="top_reports_month" role="tabpanel" aria-labelledby="top_reports_month-tab">
									{% if top_users_reports_last_month %}
										{% for user in  top_users_reports_last_month %}
										<div class="d-flex">
											<div class="avatar">
												<span class="avatar-title rounded-circle border border-white bg-info">{{user|make_list|first|upper}}</span>
											</div>
											<div class="flex-1 ml-3 pt-1">
												<h6 class="text-uppercase fw-bold mb-1">{% if forloop.counter == 1 %}<i class="fa fa-chess-king text-warning"></i>{% endif %} {{user}}</h6>
											</div>
											<div class="float-right pt-1">
												<small class="text-muted">Top {{forloop.counter}}</small>
											</div>
										</div>
										<div class="separator-dashed"></div>
										{% endfor %}
									{% else %}
										<div class="d-flex">
											<p> There're no reports created by any user yet</p>
										</div>
									{% endif %}
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>

			<!-- Activity Stats -->
			<div class="row">
				{% if user.is_superuser %}
					<div class="col-md-3 animate__animated animate__fadeIn">
						<div class="card full-height">
							<div class="card-header">
								<div class="card-head-row">
									<div class="card-title">Current Active Sessions {% if current_sessions %}({{current_sessions.count}}){% else %}(0){% endif %}</div>
								</div>
							</div>
							<div id="top-users-today" class="card-body">
								<div class="table-responsive"> 
									<table id="sessions-table" class="table table-striped table-striped-bg-default mt-3">
										<thead>
											<tr>
												<th scope="col">ID</th>
												<th scope="col">Expiration time (UTC)</th>
											</tr>
										</thead>
										<tbody>
											{% if current_sessions %}
											{% for session in current_sessions %}
												<tr>
													<td>{{session.session_key}}</td>
													<td>{{session.expire_date }}</td>
												</tr>
											{% endfor %}
											{% else %}
											<p class="text-center">There are not active sessions yet</p>
											{% endif %}
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				{% endif %}
				<div class="col-md-{% if user.is_superuser %}3{% else %}6{% endif %} animate__animated animate__fadeIn">
					<div class="card full-height">
						<div class="card-header">
							<div class="card-title">Last Activity</div>
						</div>
						<div class="card-body">
							{% if recent_actions %}
								<ol class="activity-feed">
									<li class="feed-item feed-item-secondary">
										<time class="date" datetime="{{ recent_actions.0.action_time|date:'M d H:m:s' }}">{{ recent_actions.0.action_time|date:'M d H:m:s' }}</time>
										<span class="text">{{ recent_actions.0.user.username }} - {{ recent_actions.0.content_type }}: <a href="/admin/admin/logentry/">{{ recent_actions.0.get_change_message }}</a></span>
									</li>
									<li class="feed-item feed-item-success">
										<time class="date" datetime="{{ recent_actions.1.action_time|date:'M d H:m:s' }}">{{ recent_actions.1.action_time|date:'M d H:m:s' }}</time>
										<span class="text">{{ recent_actions.1.user.username }} - {{ recent_actions.1.content_type }}: <a href="/admin/admin/logentry/">{{ recent_actions.1.get_change_message }}</a></span>
									</li>
									<li class="feed-item feed-item-info">
										<time class="date" datetime="{{ recent_actions.2.action_time|date:'M d H:m:s' }}">{{ recent_actions.2.action_time|date:'M d H:m:s' }}</time>
										<span class="text">{{ recent_actions.2.user.username }} - {{ recent_actions.2.content_type }}: <a href="/admin/admin/logentry/">{{ recent_actions.2.get_change_message }}</a></span>
									</li>
									<li class="feed-item feed-item-warning">
										<time class="date" datetime="{{ recent_actions.3.action_time|date:'M d H:m:s' }}">{{ recent_actions.3.action_time|date:'M d H:m:s' }}</time>
										<span class="text">{{ recent_actions.3.user.username }} - {{ recent_actions.3.content_type }}: <a href="/admin/admin/logentry/">{{ recent_actions.3.get_change_message }}</a></span>
									</li>
									<li class="feed-item feed-item-danger">
										<time class="date" datetime="{{ recent_actions.4.action_time|date:'M d H:m:s' }}">{{ recent_actions.4.action_time|date:'M d H:m:s' }}</time>
										<span class="text">{{ recent_actions.4.user.username }} - {{ recent_actions.4.content_type }}: <a href="/admin/admin/logentry/">{{ recent_actions.4.get_change_message }}</a></span>
									</li>
									<li class="feed-item">
										<time class="date" datetime="{{ recent_actions.5.action_time|date:'M d H:m:s' }}">{{ recent_actions.5.action_time|date:'M d H:m:s' }}</time>
										<span class="text">{{ recent_actions.5.user.username }} - {{ recent_actions.5.content_type }}: <a href="/admin/admin/logentry/">{{ recent_actions.5.get_change_message }}</a></span>
									</li>
									<li class="feed-item feed-item-secondary">
										<time class="date" datetime="{{ recent_actions.6.action_time|date:'M d H:m:s' }}">{{ recent_actions.0.action_time|date:'M d H:m:s' }}</time>
										<span class="text">{{ recent_actions.6.user.username }} - {{ recent_actions.6.content_type }}: <a href="/admin/admin/logentry/">{{ recent_actions.6.get_change_message }}</a></span>
									</li>
								</ol>
							{% else %}
								<p class="text-center">No actions performed yet</p>
							{% endif %}
						</div>
					</div>
				</div>
				<div class="col-md-6 animate__animated animate__fadeIn">
					<div class="card full-height">
						<div class="card-header">
							<div class="card-head-row">
								<div class="card-title">Last Created Rules</div>
							</div>
						</div>
						<div id="top-users-today" class="card-body">
							<div class="table-responsive"> 
								<table id="last-created-rules-table" class="table table-striped table-striped-bg-default mt-3">
									<thead>
										<tr>
											<th scope="col">ID</th>
											<th scope="col">Name</th>
											<th scope="col">Severity</th>
											<th scope="col">Detection System</th>
											<th scope="col">Created By</th>
											<th scope="col">Created At (UTC)</th>
										</tr>
									</thead>
									<tbody>
										{% if recent_rules %}
										{% for rule in recent_rules %}
											<tr>
												<td>{{rule.id}}</td>
												<td>{{rule.name}}</td>
												<td>{{rule.severity}}</td>
												<td>{{rule.detection_systems.all|join:", "}}</td>
												<td>{{rule.created_by}}</td>
												<td>{{rule.created_at}}</td>
											</tr>
										{% endfor %}
										{% else %}
										<p class="text-center">There're no rules created yet</p>
										{% endif %}
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
			
		</div>
	</div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

	<!-- Atlantis DEMO methods, don't include it in your project! -->
	<script src="/static/assets/js/setting-demo.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

	{% if user.is_superuser%}
	<script>
		$(document).ready(function() {
			$('#sessions-table').DataTable({
			});
		});
	</script>
	{% endif %}
	<script>
		$(document).ready(function() {
			$('#distribution-rules-techonolgy').DataTable({
			});
		});
	</script>
	<script>
		$(document).ready(function() {
			$('#last-created-rules-table').DataTable({

			});
		});
	</script>
	<script>
		var totalIncomeChartWeek_rule = document.getElementById('totalIncomeChartWeek-rules').getContext('2d'),
		totalIncomeChartMonth_rule = document.getElementById('totalIncomeChartMonth-rules').getContext('2d'),
		totalIncomeChartWeek_watchers = document.getElementById('totalIncomeChartWeek-watchers').getContext('2d'),
		totalIncomeChartMonth_watchers = document.getElementById('totalIncomeChartMonth-watchers').getContext('2d'),
		totalIncomeChartWeek_reports = document.getElementById('totalIncomeChartWeek-reports').getContext('2d'),
		totalIncomeChartMonth_reports = document.getElementById('totalIncomeChartMonth-reports').getContext('2d'),
		multipleLineChart = document.getElementById('multipleLineChart').getContext('2d'),
		pieChart = document.getElementById('pieChart').getContext('2d'),
		radarChart = document.getElementById('radarChart').getContext('2d');
		
		var mytotalIncomeChartWeek_rule = new Chart(totalIncomeChartWeek_rule, {
			type: 'bar',
			data: {
				labels: ['S', 'M', 'T', 'W', 'T', 'F', 'S'],
				datasets : [{
					label: "Rules",
					backgroundColor: '#ff9e27',
					borderColor: 'rgb(23, 125, 255)',
					data: {{ rules_by_day_list }},
				}],
			},
			options: {
				responsive: true,
				maintainAspectRatio: false,
				legend: {
					display: false,
				},
				scales: {
					yAxes: [{
						ticks: {
							display: false //this will remove only the label
						},
						gridLines : {
							drawBorder: false,
							display : false
						}
					}],
					xAxes : [ {
						gridLines : {
							drawBorder: false,
							display : false
						}
					}]
				},
			}
		});

		var mytotalIncomeChartWeek_watchers = new Chart(totalIncomeChartWeek_watchers, {
			type: 'bar',
			data: {
				labels: ['S', 'M', 'T', 'W', 'T', 'F', 'S'],
				datasets : [{
					label: "Rules",
					backgroundColor: '#ff9e27',
					borderColor: 'rgb(23, 125, 255)',
					data: {{ watchers_by_day_list }},
				}],
			},
			options: {
				responsive: true,
				maintainAspectRatio: false,
				legend: {
					display: false,
				},
				scales: {
					yAxes: [{
						ticks: {
							display: false //this will remove only the label
						},
						gridLines : {
							drawBorder: false,
							display : false
						}
					}],
					xAxes : [ {
						gridLines : {
							drawBorder: false,
							display : false
						}
					}]
				},
			}
		});

		var mytotalIncomeChartWeek_reports = new Chart(totalIncomeChartWeek_reports, {
			type: 'bar',
			data: {
				labels: ['S', 'M', 'T', 'W', 'T', 'F', 'S'],
				datasets : [{
					label: "Watchers",
					backgroundColor: '#ff9e27',
					borderColor: 'rgb(23, 125, 255)',
					data: {{ reports_by_day_list }},
				}],
			},
			options: {
				responsive: true,
				maintainAspectRatio: false,
				legend: {
					display: false,
				},
				scales: {
					yAxes: [{
						ticks: {
							display: false //this will remove only the label
						},
						gridLines : {
							drawBorder: false,
							display : false
						}
					}],
					xAxes : [ {
						gridLines : {
							drawBorder: false,
							display : false
						}
					}]
				},
			}
		});

		var mytotalIncomeChartMonth_rule = new Chart(totalIncomeChartMonth_rule, {
			type: 'bar',
			data: {
				labels: ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"],
				datasets: [{
					label: "Reports",
					backgroundColor: '#7db6ff',
					borderColor: 'rgb(125, 182, 255)',
					data: {{rules_by_month_list}},
				}],
			},
			options: {
				responsive: true,
				maintainAspectRatio: false,
				legend: {
					display: false,
				},
				scales: {
					yAxes: [{
						ticks: {
							display: false //this will remove only the label
						},
						gridLines : {
							drawBorder: false,
							display : false
						}
					}],
					xAxes : [ {
						gridLines : {
							drawBorder: false,
							display : false
						}
					}]
				},
			}
		});

		var mytotalIncomeChartMonth_watchers = new Chart(totalIncomeChartMonth_watchers, {
			type: 'bar',
			data: {
				labels: ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"],
				datasets: [{
					label: "Watchers",
					backgroundColor: '#7db6ff',
					borderColor: 'rgb(125, 182, 255)',
					data: {{watchers_by_month_list}},
				}],
			},
			options: {
				responsive: true,
				maintainAspectRatio: false,
				legend: {
					display: false,
				},
				scales: {
					yAxes: [{
						ticks: {
							display: false //this will remove only the label
						},
						gridLines : {
							drawBorder: false,
							display : false
						}
					}],
					xAxes : [ {
						gridLines : {
							drawBorder: false,
							display : false
						}
					}]
				},
			}
		});

		var mytotalIncomeChartMonth_reports = new Chart(totalIncomeChartMonth_reports, {
			type: 'bar',
			data: {
				labels: ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"],
				datasets: [{
					label: "Reports",
					backgroundColor: '#7db6ff',
					borderColor: 'rgb(125, 182, 255)',
					data: {{reports_by_month_list}},
				}],
			},
			options: {
				responsive: true,
				maintainAspectRatio: false,
				legend: {
					display: false,
				},
				scales: {
					yAxes: [{
						ticks: {
							display: false //this will remove only the label
						},
						gridLines : {
							drawBorder: false,
							display : false
						}
					}],
					xAxes : [ {
						gridLines : {
							drawBorder: false,
							display : false
						}
					}]
				},
			}
		});


		var myRadarChart = new Chart(radarChart, {
			type: 'radar',
			data: {
			  labels: ['Critical', 'Very High', 'High', 'Medium', 'Low', 'Informational'],
			  datasets: [{
				data: {{distribution_by_severity}}.map(value => parseInt(value, 10)),
				borderColor: '##ffc107',
				backgroundColor: 'rgba(255, 193, 7, 0.25)',
				pointBackgroundColor: "#ffc107",
				pointHoverRadius: 4,
				pointRadius: 3,
				label: 'Rules'
			  }]
			},
			options: {
			  responsive: true,
			  maintainAspectRatio: false,
			  legend: {
				position: 'bottom',
			  },
			  scale: {
				ticks: {
					display:false,
				  },
				pointLabels: {
				  fontSize: 11,
				}
			  }
			}
		  });
		  

		var myPieChart = new Chart(pieChart, {
			type: 'pie',
			data: {
				datasets: [{
					data: {{distribution_by_tactic}},
					backgroundColor: [
						"#1d7af3",  // Initial Access
						"#f3545d",  // Execution
						"#fdaf4b",  // Persistence
						"#6ab04c",  // Privilege Escalation
						"#f9c851",  // Defense Evasion
						"#4b7ad3",  // Credential Access
						"#ff8b34",  // Discovery
						"#8d6cab",  // Lateral Movement
						"#e36064",  // Collection
						"#32b4a6",  // Command and Control
						"#f9a9a3",  // Exfiltration
						"#3c434c",  // Impact
						"#b7dbab",  // Resource Development
						"#aab9d9",  // Reconnaissance
						],
					borderWidth: 0
				}],
				labels: ['Initial Access','Execution', 'Persistence', 'Privilege Escalation', 'Defense Evasion', 'Credential Access', 'Discovery', 'Lateral Movement', 'Collection', 'Command and Control', 'Exfiltration', 'Impact', 'Resource Development', 'Reconnaissance'] 
			},
			options : {
				responsive: true, 
				maintainAspectRatio: false,
				legend: {
					position : 'bottom',
					labels : {
						fontColor: 'rgb(154, 154, 154)',
						fontSize: 11,
						usePointStyle : true,
						padding: 20
					}
				},
				pieceLabel: {
					render: function(args) {
						var value = args.value;
						var percentage = args.percentage.toFixed(1) + '%';
						return value + ' (' + percentage + ')';
					  },
					fontColor: 'white',
					fontSize: 10,
				},
				tooltips: false,
				layout: {
					padding: {
						left: 20,
						right: 20,
						top: 20,
						bottom: 20
					}
				}
			}
		});

		var myMultipleLineChart = new Chart(multipleLineChart, {
			type: 'line',
			data: {
				labels: ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"],
				datasets: [{
					label: "Rules",
					borderColor: "#1d7af3",
					pointBorderColor: "#FFF",
					pointBackgroundColor: "#1d7af3",
					pointBorderWidth: 2,
					pointHoverRadius: 4,
					pointHoverBorderWidth: 1,
					pointRadius: 4,
					backgroundColor: 'transparent',
					fill: true,
					borderWidth: 2,
					data: {{rules_by_month_list}}
				},{
					label: "Watchers",
					borderColor: "#59d05d",
					pointBorderColor: "#FFF",
					pointBackgroundColor: "#59d05d",
					pointBorderWidth: 2,
					pointHoverRadius: 4,
					pointHoverBorderWidth: 1,
					pointRadius: 4,
					backgroundColor: 'transparent',
					fill: true,
					borderWidth: 2,
					data: {{watchers_by_month_list}}
				}, {
					label: "Reports",
					borderColor: "#f3545d",
					pointBorderColor: "#FFF",
					pointBackgroundColor: "#f3545d",
					pointBorderWidth: 2,
					pointHoverRadius: 4,
					pointHoverBorderWidth: 1,
					pointRadius: 4,
					backgroundColor: 'transparent',
					fill: true,
					borderWidth: 2,
					data: {{reports_by_month_list}}
				}]
			},
			options : {
				responsive: true, 
				maintainAspectRatio: false,
				legend: {
					position: 'top',
				},
				tooltips: {
					bodySpacing: 4,
					mode:"nearest",
					intersect: 0,
					position:"nearest",
					xPadding:10,
					yPadding:10,
					caretPadding:10
				},
				layout:{
					padding:{left:15,right:15,top:15,bottom:15}
				}
			}
		});
		
		$('#lineChart').sparkline([105,103,123,100,95,105,115], {
			type: 'line',
			height: '70',
			width: '100%',
			lineWidth: '2',
			lineColor: '#ffa534',
			fillColor: 'rgba(255, 165, 52, .14)'
		});
	</script>

	<!-- Export to PDF script -->
	<script>
		$(document).ready(function() {
		  $("#pdf-button").click(function() {
			// Captura el contenido HTML de tu página y envíalo al servidor para generar el PDF
			var htmlContent = document.documentElement.innerHTML;
			
			$.ajax({
			  url: "export/dashboard",  // URL del endpoint en tu servidor para generar el PDF
			  type: "POST",
			  data: {
				html_content: htmlContent,
				csrfmiddlewaretoken: "{{ csrf_token }}"
			  },
			  success: function(response) {
				// Manipula la respuesta del servidor si es necesario
				console.log(response);
			  },
			  error: function(xhr, status, error) {
				// Maneja los errores si es necesario
				console.log(error);
			  }
			});
		  });
		});
	  </script>
		


{% endblock javascripts %}
